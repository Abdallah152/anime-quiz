<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ูููุน ุงุณุฆูุฉ ุงููู</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: 20px auto; padding: 12px; background: #f7f9fc; direction: rtl; }
    h1,h2 { text-align: center; color:#222; margin:8px 0; }
    #controls { display:flex; gap:8px; justify-content:center; align-items:center; margin-bottom:12px; flex-wrap:wrap; }
    #score { font-weight:700; color:#0b69ff; }
    .question, .add-question { background:#fff; padding:14px; margin-bottom:14px; border-radius:10px; box-shadow:0 4px 12px rgba(12,20,40,0.06); }
    img { max-width:100%; border-radius:8px; display:block; margin:6px 0; object-fit:cover; }
    input[type="text"], input[type="url"], textarea, button {
      width:100%; padding:8px 10px; margin-top:8px; margin-bottom:10px; border-radius:6px; border:1px solid #d0d7e4; box-sizing:border-box; font-size:15px;
    }
    .row { display:flex; gap:8px; }
    .row > * { flex:1; }
    button { background:#0b69ff; color:white; cursor:pointer; border:none; padding:10px; }
    button.secondary { background:#e6eefc; color:#0b69ff; border:1px solid #cfe1ff; }
    button:hover { filter:brightness(.96); }
    .result { margin-top:8px; font-weight:700; }
    .small { font-size:13px; color:#666; }
  </style>
</head>
<body>

  <h1>ูููุน ุฃุณุฆูุฉ ุฃููู</h1>

  <div id="controls">
    <div id="score">ุงูููุงุท: 0</div>
    <button id="reset-score" class="secondary">ุฅุนุงุฏุฉ ุถุจุท ุงูููุงุท</button>
    <div class="small">(ูู ุฅุฌุงุจุฉ ุตุญูุญุฉ +1 ุ ุฎุงุทุฆุฉ -1)</div>
  </div>

  <div id="quiz-container"></div>

  <div class="add-question">
    <h2>ุฃุถู ุณุคุงู ุฃููู ุฌุฏูุฏ</h2>
    <form id="add-question-form">
      <label>ุฑุงุจุท ุตูุฑุฉ ุงูุดุฎุตูุฉ (URL):</label>
      <input type="url" id="image-url" placeholder="https://..." required />
      
      <label>ุงุณู ุงูุดุฎุตูุฉ:</label>
      <input type="text" id="character-name" placeholder="ุงูุชุจ ุงุณู ุงูุดุฎุตูุฉ" required />
      
      <label>ุณุคุงู (ุงุฎุชูุงุฑู):</label>
      <textarea id="question-text" placeholder="ูุซูุงู: ูู ูู ูุฐุง ุงูุดุฎุตูุฉุ"></textarea>
      
      <button type="submit">ุฃุถู ุงูุณุคุงู</button>
    </form>
  </div>

  <script>
    // ===== ุชุฎุฒูู ูุงุณุชุฑุฌุงุน ูู localStorage =====
    const STORAGE_Q = 'animeQuiz_questions_v1';
    const STORAGE_SCORE = 'animeQuiz_score_v1';

    // ===== ุญุงูุฉ ุงูุชุทุจูู =====
    let score = Number(localStorage.getItem(STORAGE_SCORE) || 0);
    let answered = new Set();
    let questions = JSON.parse(localStorage.getItem(STORAGE_Q)) || [
      { image:"https://i.pinimg.com/736x/cb/03/ce/cb03cebb51672e3df6eda6e7cc33bcb6.jpg", answer:"ุงูุชุดููุง ูุงุฏุงุฑุง", question:"ูู ูู ูุฐุง ุงูุดุฎุตูุฉุ" },
      { image:"https://i.pinimg.com/1200x/97/76/bc/9776bc7b72009a691cb6f753c3c0cf7b.jpg", answer:"ูุงุดูุฑุงูุง ุณููุฌู", question:"ูู ูู ูุฐุง ุงูุดุฎุตูุฉุ" },
      { image:"https://i.pinimg.com/736x/a6/35/05/a63505d2078c82849aca9c3042700819.jpg", answer:"ุชูุจูุฑุงูุง ุณููุฌู", question:"ูู ูู ูุฐุง ุงูุดุฎุตูุฉุ" },
      { image:"https://i.pinimg.com/736x/b0/73/a9/b073a98e6d76db6df7aec0a32c91bcea.jpg", answer:"ุชูุฌู ูููุดุฑู", question:"ูู ูู ูุฐุง ุงูุดุฎุตูุฉุ" },
          { image:"https://i.pinimg.com/1200x/f3/13/10/f313101a2ea59060f395fd2e3f6b42a3.jpg", answer:"ุงูุชุดููุง ุงูุชุงุดู", question:"ูู ูู ูุฐุง ุงูุดุฎุตูุฉุ" },

     ];
    // ===== ุนูุงุตุฑ DOM =====
    const scoreDiv = document.getElementById('score');
    const quizContainer = document.getElementById('quiz-container');
    const form = document.getElementById('add-question-form');
    const resetBtn = document.getElementById('reset-score');

    // ===== ูุณุงุนุฏุฉ: ุชุทุจูุน ุงููุต ุงูุนุฑุจู ูุชูููู ุชุฃุซูุฑ ุงูุชุดููู ูุงูููุฒุงุช =====
    function normalizeArabic(str = '') {
      return String(str)
        .replace(/[\u064B-\u065F\u0610-\u061A\u06D6-\u06ED]/g, '') // ุฅุฒุงูุฉ ุงูุชุดููู
        .replace(/[ุขุฃุฅ]/g, 'ุง')
        .replace(/ู/g, 'ู')
        .replace(/ุค/g, 'ู')
        .replace(/ุฆ/g, 'ู')
        .replace(/ุฉ/g, 'ู')
        .replace(/ู/g, '')
        .replace(/[^\u0600-\u06FF0-9a-z\s]/gi, '') // ุฅุฒุงูุฉ ุนูุงูุงุช ุชุฑููู ุบุฑูุจุฉ
        .trim().toLowerCase();
    }

    // ===== ุชุญุฏูุซ ูุญูุธ ุงูุญุงูุฉ =====
    function updateScoreDisplay() {
      scoreDiv.textContent = `ุงูููุงุท: ${score}`;
      localStorage.setItem(STORAGE_SCORE, String(score));
    }

    function saveQuestions() {
      localStorage.setItem(STORAGE_Q, JSON.stringify(questions));
    }

    // ===== ุนุฑุถ ุงูุฃุณุฆูุฉ (DOM ุขูู ุจุฏูู innerHTML ูููุญุชูู ุงูุฏููุงูููู) =====
    function renderQuestions() {
      quizContainer.innerHTML = '';
      questions.forEach((q, index) => {
        const card = document.createElement('div');
        card.className = 'question';

        const img = document.createElement('img');
        img.src = q.image;
        img.alt = 'ุดุฎุตูุฉ ุฃููู';
        img.onerror = function() { this.onerror = null; this.src = 'https://via.placeholder.com/600x360?text=No+Image'; };

        const p = document.createElement('p');
        p.textContent = q.question || 'ุฎูู ุงุณู ูุฐู ุงูุดุฎุตูุฉ:';

        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = 'ุงูุชุจ ุงุณู ุงูุดุฎุตูุฉ ููุง';
        input.id = `input-${index}`;
        input.addEventListener('keydown', (e) => { if (e.key === 'Enter') checkAnswer(index); });

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.textContent = 'ุชุญูู';
        btn.addEventListener('click', () => checkAnswer(index));

        const resultDiv = document.createElement('div');
        resultDiv.id = `result-${index}`;
        resultDiv.className = 'result';

        card.appendChild(img);
        card.appendChild(p);
        card.appendChild(input);
        card.appendChild(btn);
        card.appendChild(resultDiv);

        quizContainer.appendChild(card);
      });
    }

    // ===== ููุทู ุงูุชุญูู ูุน ูุฑููุฉ ูู ุงูููุงุฑูุฉ =====
    function checkAnswer(index) {
      const inputEl = document.getElementById(`input-${index}`);
      const resultDiv = document.getElementById(`result-${index}`);

      if (answered.has(index)) {
        resultDiv.style.color = 'orange';
        resultDiv.textContent = 'ููุฏ ุฃุฌุจุช ูุฐุง ุงูุณุคุงู ุจุงููุนู.';
        return;
      }

      const userRaw = inputEl.value || '';
      const user = normalizeArabic(userRaw);
      const correctRaw = questions[index].answer || '';
      const correct = normalizeArabic(correctRaw);

      if (!user) {
        resultDiv.style.color = 'red';
        resultDiv.textContent = 'ูุฑุฌู ูุชุงุจุฉ ุฅุฌุงุจุฉ';
        return;
      }

      // ูุจูู ุงูุฅุฌุงุจุฉ ุฅุฐุง ุชุทุงุจูุช ุชูุงูุงู ุฃู ุฅุฐุง ูุงูุช ูู ูููุงุช ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ ููุฌูุฏุฉ ูู ูุง ุฃุฏุฎูู ุงููุณุชุฎุฏู
      const correctWords = correct.split(/\s+/).filter(Boolean);
      const allWordsPresent = correctWords.length === 0 ? false : correctWords.every(w => user.includes(w));
      const isCorrect = user === correct || allWordsPresent;

      answered.add(index);

      if (isCorrect) {
        resultDiv.style.color = 'green';
        resultDiv.textContent = 'ุฅุฌุงุจุฉ ุตุญูุญุฉ! ๐';
        score += 1;
      } else {
        resultDiv.style.color = 'red';
        resultDiv.textContent = `ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ: ${questions[index].answer}`;
        score -= 1;
      }

      updateScoreDisplay();
    }

    // ===== ุฅุถุงูุฉ ุณุคุงู ุฌุฏูุฏ =====
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const imageUrl = document.getElementById('image-url').value.trim();
      const characterName = document.getElementById('character-name').value.trim();
      const questionText = document.getElementById('question-text').value.trim();

      if (!imageUrl || !characterName) {
        alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฑุงุจุท ุงูุตูุฑุฉ ูุงุณู ุงูุดุฎุตูุฉ');
        return;
      }

      questions.push({
        image: imageUrl,
        answer: characterName,
        question: questionText || 'ุฎูู ุงุณู ูุฐู ุงูุดุฎุตูุฉ:'
      });

      saveQuestions();
      form.reset();
      renderQuestions();
      alert('ุชู ุฅุถุงูุฉ ุงูุณุคุงู ุจูุฌุงุญ!');
    });

    // ===== ุฒุฑ ุฅุนุงุฏุฉ ุถุจุท ุงูููุงุท =====
    resetBtn.addEventListener('click', () => {
      if (!confirm('ูู ุชุฑูุฏ ุฅุนุงุฏุฉ ุถุจุท ุงูููุงุท ูุฅุนุงุฏุฉ ุงูุณูุงุญ ุจุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉุ')) return;
      score = 0;
      answered.clear();
      updateScoreDisplay();
      // ูุนูุฏ ุฅุฒุงูุฉ ุงููุชุงุฆุฌ ุงูุธุงูุฑุฉ
      document.querySelectorAll('.result').forEach(d => d.textContent = '');
    });

    // ===== ุชููุฆุฉ ุงูุนุฑุถ =====
    updateScoreDisplay();
    renderQuestions();
  </script>

</body>
</html>
